# E3-F3-S1 Port LAB-based tonal generation, easing, and blending utilities to TypeScript with tests

## User Story

As a developer, I want the tonal generation logic rewritten as typed utilities so the scale math stays accurate and testable during the migration.

## Related Epic

- [E3](./E3.md) – Tonal scale builder migration epic.

## Related Feature

- [E3-F3](./E3-F3.md) – Tonal generation and color math engine feature.

## Scope

- Port LAB conversion, chroma falloff, and 0–100 tonal ramp generation from the prototype into TypeScript modules.
- Recreate blending algorithms (dodge, overlay, soft/hard light, darken/lighten, multiply/screen, color burn/dodge, vivid light, hue replacement) with channel-range validation.
- Implement cubic-bezier easing for tone shaping with configurable midpoint and spread, plus saturation easing per dark/light halves.
- Add unit tests covering conversions, blend outputs, easing curves, and guardrails for invalid inputs.
- Extract the tonal math into pure, stateless functions rather than embedding state mutations (`State.setBlendDistGraphData`, `setScaleData`) and DOM writes as seen in the prototype’s generator, so it can be reused by stores and components without side effects.【F:temp/src/js/index.js†L440-L520】

## Acceptance Criteria

- A TypeScript module/composable generates 101-step tonal scales based on a base color and parameters, matching prototype expectations.
- Blending utilities mirror the prototype formulas and reject out-of-range channel values via tests.
- Easing functions apply to tone shaping and saturation adjustments; tests assert midpoint/spread behavior for dark and light sides.
- Vitest suite passes for the new utilities; coverage includes happy paths and error handling.
- Modules expose deterministic inputs/outputs with no DOM or global state dependencies so other layers can consume them predictably.

## Notes

- Use the `temp/` tonal math as the authoritative source; outputs and edge cases must stay identical, adding only typing and tests to preserve 1:1 behavior.
